<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script
    src="https://code.jquery.com/jquery-3.3.1.js"
    integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" 
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <title>Apophis Calculations</title>
</head>
<body>
    <div class="container-fluid text-center mb-5">
        <div class="row justify-content-center d-flex">
            <div class="col-5" style="max-width: 500;">
                <h1>Apophis Bistatic Radar Calculations</h1>
                    <label for="obs1">First Observatory:</label>
                    <select id="obs1" name="id1" class="custom-select"></select>
                    <p></p>
                    <label for="obs2">Second Observatory:</label>
                    <select id="obs2" name="id2" class="custom-select"></select>
                    <p></p>
                    <div class="container"><button type="button" class="btn btn-primary" onclick="update()">Update</button></div>

            </div>
        </div>
        <div class="divider-10"></div>
    </div>
    <div class="container-fluid">
        <div class="row justify-content-center d-flex">
            <div class="col"></div>
            <div class="col border rounded mx-2" id="dom_obj">
                <h2>Observatory Data</h2>
            </div>
            <div class="col border rounded mx-2" id="eph_data">
                <h2>Ephemeris Data</h2>
            </div>
            <div class="col"></div>
        </div>
    </div>
    <script>
        async function loadObs(){
            let response = await fetch("http://127.0.0.1:8000/observatories");
            let elements = await response.json();
            let select1 = document.querySelector("#obs1");
            let select2 = document.querySelector("#obs2");
            let i = 0;
            for (let elt of elements){
                elt = elt.replace("[","")
                elt = elt.replace("]","")
                elt = elt.replaceAll("'","")
                for (let sel of [select1,select2]){
                    let option = document.createElement("option");
                    option.text = elt;
                    option.value = i;
                    sel.appendChild(option);
                }   
                i++
            }
        }
        loadObs()
        async function obsInfo(){
            let id1 = document.querySelector("#obs1").value;
            let id2 = document.querySelector("#obs2").value;
            let response = await fetch("http://127.0.0.1:8000/observatories_info?id1="+id1+"&id2="+id2+"&remarks=false");
            let obj_json = await response.json()

            let dom_obj = document.querySelector("#dom_obj")
            dom_obj.innerHTML = "<h2>Observatory Data</h2>"
            
            for (let key in obj_json){
                newElement(dom_obj,"h4",obj_json[key]["Name"])
                for (let key2 in obj_json[key]){
                    if (key2 != "Name"){
                        newElement(dom_obj,"p",key2+": "+obj_json[key][key2])
                    }
                }
            }
            console.log(obj_json)
        }

        async function ephemInfo(){
            let id1 = document.querySelector("#obs1").value;
            let id2 = document.querySelector("#obs2").value;
            let response = await fetch("http://127.0.0.1:8000/ephemeris_info?id1="+id1+"&id2="+id2);
            let obj_json = await response.json()
            console.log(obj_json)

            let dom_obj = document.querySelector("#eph_data")
            dom_obj.innerHTML = "<h2>Ephemeris Data</h2>"

            for (let key in obj_json){
                newElement(dom_obj,"h4",obj_json[key]["Name"])
                for (let key2 in obj_json[key]){
                    if ((key2 != "Name")&&(key2 != "Max Elevation")){
                        newElement(dom_obj,"p",key2+": "+obj_json[key][key2])
                    }
                    if (key2 == "Max Elevation"){
                        newElement(dom_obj,"h5","Max Elevation:")
                        for (let key3 in obj_json[key][key2]) {
                            newElement(dom_obj,"p","\t"+key3+": "+obj_json[key][key2][key3])
                        }
                    }
                }
            }
        }

        function newElement(dom_obj,tag_,cont_) {
            let tag = document.createElement(tag_)
            let text = document.createTextNode(cont_)
            tag.appendChild(text)
            dom_obj.appendChild(tag)
        }

        async function update(){
            ephemInfo()
            obsInfo()
        }
    </script>
</body>
</html>